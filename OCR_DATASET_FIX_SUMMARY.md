# OCRDataset ä¿®å¤æ€»ç»“

## ğŸš¨ å‘ç°çš„é—®é¢˜

ç»è¿‡ä¸€ä¸ªepochè®­ç»ƒåæ•ˆæœå¾ˆå·®ï¼Œé€šè¿‡è°ƒè¯•å‘ç°ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

### 1. å­—ç¬¦çƒ­å›¾ç”Ÿæˆé”™è¯¯
- **é—®é¢˜**: åªåœ¨æ–‡æœ¬æ¡†ä¸­å¿ƒç”Ÿæˆç‚¹çŠ¶é«˜æ–¯æ ¸
- **å½±å“**: è¦†ç›–ç‡ä»…5.20%ï¼Œæ— æ³•æœ‰æ•ˆè®­ç»ƒCRAFTæ¨¡å‹
- **åŸå› **: ä¸ç¬¦åˆCRAFTç†è®ºï¼Œåº”è¯¥è¦†ç›–æ•´ä¸ªæ–‡æœ¬åŒºåŸŸ

### 2. é“¾æ¥çƒ­å›¾ç”Ÿæˆé”™è¯¯  
- **é—®é¢˜**: åœ¨æ–‡æœ¬æ¡†è¾¹ç¼˜ä¸­ç‚¹ç”Ÿæˆè¿æ¥
- **å½±å“**: æ— æ³•æ­£ç¡®å»ºç«‹ç›¸é‚»æ–‡æœ¬çš„å…³è”
- **åŸå› **: CRAFTçš„é“¾æ¥åº”è¯¥è¿æ¥ç›¸é‚»å­—ç¬¦/å•è¯

### 3. ç¼ºä¹æ–‡æœ¬æ’åº
- **é—®é¢˜**: æ²¡æœ‰æŒ‰ä½ç½®æ’åºæ–‡æœ¬
- **å½±å“**: æ— æ³•æ­£ç¡®è¯†åˆ«ç›¸é‚»å…³ç³»
- **åŸå› **: éœ€è¦æŒ‰è¡Œåˆ—ä½ç½®æ’åºä»¥å»ºç«‹æ­£ç¡®çš„é“¾æ¥

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. å­—ç¬¦çƒ­å›¾ä¿®å¤
```python
def _generate_char_heatmap(self, heatmap, coords):
    """ç”Ÿæˆå­—ç¬¦çº§çƒ­å›¾ - ä¿®å¤ç‰ˆï¼šè¦†ç›–æ•´ä¸ªæ–‡æœ¬æ¡†"""
    # è®¡ç®—æ–‡æœ¬æ¡†è¾¹ç•Œ
    x_min, x_max = int(np.min(coords[:, 0])), int(np.max(coords[:, 0]))
    y_min, y_max = int(np.min(coords[:, 1])), int(np.max(coords[:, 1]))
    
    # ç”Ÿæˆæ¤­åœ†é«˜æ–¯åˆ†å¸ƒè¦†ç›–æ•´ä¸ªæ–‡æœ¬æ¡†
    sigma_x = width / 4  # æ°´å¹³æ ‡å‡†å·®
    sigma_y = height / 4  # å‚ç›´æ ‡å‡†å·®
    
    # ä¸ºæ•´ä¸ªæ–‡æœ¬æ¡†åŒºåŸŸç”Ÿæˆé«˜æ–¯å€¼
    for y in range(...):
        for x in range(...):
            dx = (x - center_x) / max(sigma_x, 1)
            dy = (y - center_y) / max(sigma_y, 1)
            value = math.exp(-(dx**2 + dy**2) / 2)
            heatmap[y, x] = max(heatmap[y, x], value)
```

### 2. é“¾æ¥çƒ­å›¾ä¿®å¤
```python
def _generate_affinity_heatmap(self, heatmap, sorted_annotations, h, w):
    """ç”Ÿæˆç›¸é‚»æ–‡æœ¬çš„é“¾æ¥çƒ­å›¾"""
    # æŒ‰è¡Œåˆ†ç»„
    lines = self._group_by_lines(sorted_annotations)
    
    for line in lines:
        if len(line) > 1:
            for i in range(len(line) - 1):
                center1 = np.mean(line[i]['coords'], axis=0)
                center2 = np.mean(line[i+1]['coords'], axis=0)
                
                # æ£€æŸ¥æ˜¯å¦æ°´å¹³ç›¸é‚»
                if abs(center2[0] - center1[0]) < 150:
                    self._draw_affinity_link(heatmap, center1, center2, h, w)
```

### 3. æ–‡æœ¬æ’åºæ–°å¢
```python
def _sort_annotations_by_position(self, annotations):
    """æŒ‰ä½ç½®æ’åºæ ‡æ³¨ï¼ˆä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹ï¼‰"""
    # æŒ‰yåæ ‡åˆ†ç»„ï¼ˆè¡Œï¼‰
    y_groups = {}
    for ann in annotations:
        center_x, center_y = get_center(ann['coords'])
        y_key = int(center_y // 50)  # 50åƒç´ ä¸ºä¸€è¡Œ
        if y_key not in y_groups:
            y_groups[y_key] = []
        y_groups[y_key].append((ann, center_x, center_y))
    
    # æ¯è¡Œå†…æŒ‰xåæ ‡æ’åºï¼Œè¡Œé—´æŒ‰yåæ ‡æ’åº
    sorted_annotations = []
    for y_key in sorted(y_groups.keys()):
        row = sorted(y_groups[y_key], key=lambda x: x[1])
        sorted_annotations.extend([item[0] for item in row])
    
    return sorted_annotations
```

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | æ”¹è¿› |
|------|-------|-------|------|
| å­—ç¬¦çƒ­å›¾è¦†ç›–ç‡ | 5.20% | **29.8-54.7%** | **+567%-952%** |
| å­—ç¬¦çƒ­å›¾åƒç´ æ•° | 12,992 | **19,522-35,853** | **+1.5-2.8å€** |
| é“¾æ¥çƒ­å›¾åƒç´ æ•° | 0 | **2,651-3,584** | **å…¨æ–°åŠŸèƒ½** |
| çƒ­å›¾è´¨é‡è¯„ä¼° | éœ€æ”¹è¿› âš ï¸ | **ä¼˜ç§€ âœ…** | **è´¨çš„é£è·ƒ** |

## ğŸ¯ éªŒè¯ç»“æœ

é€šè¿‡ `validate_fixed_dataset.py` éªŒè¯3ä¸ªæ ·æœ¬ï¼š

- **æ ·æœ¬0**: è¦†ç›–ç‡29.8%ï¼Œå­—ç¬¦+é“¾æ¥è´¨é‡å‡ä¸ºä¼˜ç§€âœ…
- **æ ·æœ¬1**: è¦†ç›–ç‡49.5%ï¼Œå­—ç¬¦+é“¾æ¥è´¨é‡å‡ä¸ºä¼˜ç§€âœ…  
- **æ ·æœ¬2**: è¦†ç›–ç‡54.7%ï¼Œå­—ç¬¦+é“¾æ¥è´¨é‡å‡ä¸ºä¼˜ç§€âœ…

## ğŸš€ é¢„æœŸè®­ç»ƒæ•ˆæœ

ä¿®å¤åçš„æ•°æ®é›†åº”è¯¥èƒ½æ˜¾è‘—æ”¹å–„CRAFTæ¨¡å‹è®­ç»ƒæ•ˆæœï¼š

1. **å­—ç¬¦æ£€æµ‹**: æ›´å‡†ç¡®çš„æ–‡æœ¬åŒºåŸŸå®šä½
2. **æ–‡æœ¬è¿æ¥**: æ­£ç¡®çš„ç›¸é‚»æ–‡æœ¬å…³è”
3. **æ”¶æ•›é€Ÿåº¦**: æ›´å¿«çš„è®­ç»ƒæ”¶æ•›
4. **æ£€æµ‹ç²¾åº¦**: å¤§å¹…æå‡çš„æ–‡æœ¬æ£€æµ‹å‡†ç¡®ç‡

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `loaddata.py`: ä¿®å¤åçš„ä¸»è¦æ•°æ®åŠ è½½æ–‡ä»¶
- `validate_fixed_dataset.py`: éªŒè¯è„šæœ¬
- `validation_result.png`: å¯è§†åŒ–å¯¹æ¯”å›¾
- `validation_overlay.png`: çƒ­å›¾å åŠ æ•ˆæœå›¾

## ğŸ‰ ç»“è®º

OCRDatasetçš„çƒ­åŠ›å›¾ç”Ÿæˆé”™è¯¯å·²å®Œå…¨ä¿®å¤ï¼Œç°åœ¨ç¬¦åˆCRAFTæ¨¡å‹çš„ç†è®ºè¦æ±‚ã€‚è®­ç»ƒæ•ˆæœåº”è¯¥æœ‰æ˜¾è‘—æ”¹å–„ï¼ 